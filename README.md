# Psychotherapy AI Assistant: Prompt Engineering

Be sure you checked the usage in your [dashboard](https://platform.openai.com/account/usage), the generation using `gpt-4` cost a lot D:

## Description

This project utilizes OpenAI's GPT model to generate multiple fictitious answers to a list of questions, particularly for running psychotherapy report summarization test in Traditional Chinese. It is designed to generate creative responses by emulating a character in need of psychotherapy treatment. The script uses threading to handle multiple requests concurrently, and it also handles API rate limits and other exceptions for a smooth user experience.
Using techniques introduced here: [INSTRUCT](https://medium.com/@ickman/instruct-making-llms-do-anything-you-want-ff4259d4b91), we designed a prompt that can perform accurate fictitious answer generation and psychotherapy report summarization.

## Installation

- To install, you need Python installed on your system. The version used for developing this script is Python 3.8, but it should be compatible with other Python 3 versions as well.

- To get started, first clone the repository to your local system.
- Next, navigate to the directory containing the script. Install the required Python packages using pip:

```bash
pip install -r requirements.txt
```

## Usage

### General Arguments

To use this 2 scripts, you need to have an active OpenAI API key. You can either pass this as an argument (`--openai_api_key <your api key>`) or set it as an environment variable (`OPENAI_API_KEY`).

The scripts supports several command line arguments:

- `--model`: Name of the model to use (default is "gpt-4").
- `--temperature`: Controls randomness of the model's output (default is 0.7).
- `--max_tokens`: Maximum number of tokens for the model to generate (default is 1000).
- `--thread_num`: Number of threads to run in parallel (default is 2).
- `--questions_path`: Path to the JSON file containing the list of questions (default is "questions.json").

### `generate_answer.py`

- `--request_num`: Number of fictitious answer requests (default is 8).
- `--characters_path`: Path to the JSON file containing the list of characters (default is "characters.json").
- `--answers_template_path`: Path to the JSON file containing the answers template (default is "answers_template.json").

```bash
python generate_answer.py --model gpt-4 --temperature 0.7 --max_tokens 2000 --thread_num 8 --request_num 10 --questions_path questions.json --characters_path characters.json --answers_template_path answers_template.json --openai_api_key <your-api-key>
```

Generate 100 answers cost about $2

### `generate_report.py`

- `--answers_path`: Path to the directory containing the generated answers (default is "cleaned_answers").
- `--response_template_path`: Path to the JSON file containing the response template (default is "response_template.json").

```bash
python generate_report.py --model gpt-3.5-turbo --temperature 0.7 --max_tokens 1000 --thread_num 2 --questions_path questions.json --response_template_path response_template.json --answers_path ./cleaned_answers/ --openai_api_key <your-api-key>
```

Generate 100 reports cost about $2


## Example

Let's assume you have a JSON file named `questions.json` that contains an array of questions. The content of `questions.json` might look like this:

```json
[
    "你以前有過諮商的經驗，或者接受過任何形式的心理治療嗎？",
    "目前你有任何疾病或是用藥的情況嗎？",
    "你的童年過得怎麼樣？有沒有什麼重大的事件特別印象深刻？",
    "你能告訴我一下你現在的工作或學校狀況嗎？"
]
```

Then you have another JSON file named `characters.json`, which contains an array of characters properties such as name, gender, age, job, personality. The content of `characters.json` might look like this:

```json
[
    "Name: 張宏偉, Gender: 男, Age: 45, Job: 醫生, Personality: 專業、細心、有同理心",
    "Name: 林美玲, Gender: 女, Age: 35, Job: 律師, Personality: 聰明、果斷、有堅持",
    "Name: 王明健, Gender: 男, Age: 32, Job: 商人, Personality: 企業家精神、風險承擔能力高",
    "Name: 蔡雅琳, Gender: 女, Age: 40, Job: 銀行家, Personality: 細緻、謹慎、擅長分析",
    "Name: 陳建興, Gender: 男, Age: 52, Job: 工程師, Personality: 創新、務實、有耐心",
]
```

These data can easily generated by providing this prompt: `Create 100 human characters in Traditional Chinese with different gender, age, job, personality. example like below:
Name: 陳小芬, Gender: 女, Age: 28, Job: 教師, Personality: 熱情、健談、善於建立人際關係` to ChatGPT.

Then, you can run `generate_answer.py` as follows:

```bash
python generate_answer.py --model gpt-4 --temperature 0.7 --max_tokens 2000 --thread_num 8 --request_num 10 --questions_path questions.json --characters_path characters.json --answers_template_path answers_template.json --openai_api_key <your-api-key>
```

The script will generate 10 responses to these questions, emulating the persona of a character in need of psychotherapy treatment. The responses will be saved in directories: `answers`, `cleaned_answers`, and `extracted_failed_answers`.

Then you can run `generate_report.py` to generate reports from the generated answers:

```bash
python generate_report.py --model gpt-3.5-turbo --temperature 0.7 --max_tokens 1000 --thread_num 2 --questions_path questions.json --response_template_path response_template.json --answers_path ./cleaned_answers/ --openai_api_key <your-api-key>
```

Finally you'll see the report in `cleaned_reports` directory. An example like this:

```txt
# 李偉民 的分析報告

## 個人資料
李偉民，男性，42歲，官員。

## 想要解決的問題
李偉民因在工作中遇到道德困境而感到困惑和掙扎，希望透過心理治療來處理這個問題。

## 問題的緣由
李偉民透露這個問題已經持續了幾個月，以前沒有接受過諮商或心理治療。

## 疾病歷史
目前沒有任何疾病或用藥的情況。

## 個人背景
李偉民的童年過得還算不錯，沒有特別深刻的重大事件。個性正直、公平、有遠見。喜歡閱讀歷史書籍，擅長溝通協調。

## 社交關係
李偉民與家人和朋友的關係都很融洽，相互支持。

## 家庭關係
沒有提到明顯的家庭問題。

## 家庭背景
沒有提到明顯的家庭問題。

## 治療目標
李偉民希望透過心理治療來處理道德困境，增強自信心，並能夠更好地應對工作和生活中的壓力。

## 遺漏資訊
沒有提到明顯的缺失信息。
```

Any result that is not valid will be saved in `extracted_failed_answers` and `extracted_failed_reports` directory.

---

This project is not a replacement for professional psychotherapists. It's a tool designed to assist in the process of psychotherapy treatment and should be used as such.